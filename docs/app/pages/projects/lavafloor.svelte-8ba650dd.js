var ue=Object.defineProperty;var me=(n,s,t)=>s in n?ue(n,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[s]=t;var N=(n,s,t)=>(me(n,typeof s!="symbol"?s+"":s,t),t);import{V as A,R as ae,T as oe,U as pe,W as we,X as U,Y as ne,Z as O,_ as ee,$ as J,a0 as $,S as fe,i as ve,s as ye,e as P,t as L,c as x,a as q,g as C,d as b,b as ie,f as K,F as l,k as I,E as be,n as B,K as te,h as re,L as ce,a1 as ke,a2 as ge,a3 as Ee,a4 as Se,a5 as Me,a6 as De,a7 as _e,a8 as Pe,a9 as Le,aa as xe,A as qe,ab as Ce,ac as ze,ad as je,ae as Ie,af as Be}from"../../chunks/vendor-990aac60.js";class He{constructor(s,t,o){N(this,"PI_2",Math.PI/2);N(this,"twoPI",Math.PI*2);N(this,"downAxis",new A(0,-1,0));this.object=s,this.camera=t,this.domElement=o,this.offset=new A,this.cameraQuat=new ae().setFromUnitVectors(t.up,new A(0,1,0)),this.cameraQuatInv=this.cameraQuat.inverse(),this.spherical=new oe,this.sphericalDelta=new oe,this.minDistance=0,this.maxDistance=20,this.distanceStepSize=1,this.currentDistance=6,this.distanceTheshold=5,this.isLocked=!1,this.isGrounded=!1,this.move={left:0,right:0,up:0,down:0,forward:0,backward:0},this.acceleration=12,this.canMove=!0,document.addEventListener("mousedown",async e=>{e.stopPropagation(),this.onMouseDown()}),document.addEventListener("contextmenu",async e=>{e.preventDefault(),this.onMouseDown()}),document.addEventListener("pointerlockchange",async()=>{this.onPointerLockChange()}),document.addEventListener("mousemove",async e=>{this.onMouseMove(e)}),document.addEventListener("keydown",async e=>{this.onKeyDown(e)}),document.addEventListener("keyup",async e=>{this.onKeyUp(e)}),document.addEventListener("wheel",async e=>{this.onWheel(e)}),this.isLocked=!0,this.onMouseMove(new MouseEvent("mousemove",{movementX:0,movementY:0})),this.isLocked=!1}onMouseMove(s){if(this.isLocked===!1)return;const t=s.movementX||0,o=s.movementY||0,e=new A().copy(this.object.position);this.sphericalDelta.theta=this.twoPI*t/this.domElement.clientHeight,this.sphericalDelta.phi=this.twoPI*o/this.domElement.clientHeight,this.offset.copy(this.camera.position).sub(e),this.offset.applyQuaternion(this.cameraQuat),this.spherical.setFromVector3(this.offset),this.spherical.theta-=this.sphericalDelta.theta,this.spherical.phi-=this.sphericalDelta.phi,this.spherical.phi=Math.max(0,Math.min(Math.PI,this.spherical.phi)),this.spherical.makeSafe(),this.spherical.radius=this.currentDistance,this.offset.setFromSpherical(this.spherical),this.offset.applyQuaternion(this.cameraQuatInv),this.update()}onMouseDown(){this.isLocked||this.domElement.requestPointerLock()}onPointerLockChange(){document.pointerLockElement===this.domElement?this.isLocked=!0:this.isLocked=!1}onKeyDown(s){if(this.canMove)switch(s.key){case"a":this.move.left=1;break;case"d":this.move.right=1;break;case"w":this.move.forward=1;break;case"s":this.move.backward=1;break;case" ":this.isGrounded&&(this.move.up=1);break;case"e":this.spawnCube();break}}onKeyUp(s){switch(s.key){case"a":this.move.left=0;break;case"d":this.move.right=0;break;case"w":this.move.forward=0;break;case"s":this.move.backward=0;break;case" ":this.move.up=0;break}}onWheel(s){const t=s.deltaY>0?this.distanceStepSize:-this.distanceStepSize;this.currentDistance>=this.minDistance-t&&this.currentDistance<=this.maxDistance-t&&(this.currentDistance+=t),this.onMouseMove(new MouseEvent("mousemove",{movementX:0,movementY:0}))}getPlayerDirection(){return new A(-this.move.left+this.move.right,0,-this.move.forward+this.move.backward).normalize()}update(){const s=this.getPlayerDirection().applyQuaternion(this.object.quaternion).multiplyScalar(this.acceleration);this.object.velocity.set(s.x,this.object.velocity.y,s.z),this.move.up&&this.isGrounded?this.object.velocity.y=10:this.isGrounded&&(this.object.velocity.y=0);const t=new A().copy(this.object.position);this.camera.position.copy(t).add(this.offset),this.camera.lookAt(t);try{const i=new pe(t,this.downAxis,0,1.1).intersectObjects([this.camera.parent],!0);if(i.length>0){if(this.canMove)switch(i[0].object.name){case"floor":document.dispatchEvent(new CustomEvent("player",{detail:i[0]})),this.canMove=!1;break;case"randomCube":document.dispatchEvent(new CustomEvent("player",{detail:i[0]}));break;default:break}this.isGrounded=!0}else this.isGrounded=!1}catch{}const o=new we().setFromQuaternion(this.camera.quaternion);o.reorder("YXZ"),o.x=0;const e=new ae().setFromEuler(o);this.object.quaternion.set(e.x,e.y,e.z,e.w)}}function Qe(n,s,t){const o=new U({color:11184810}),e=new ne(2,2,2);for(let i=0;i<100;i++){const w=new O(e,o),k=50,v=Math.random()<.5?-1:1,u=Math.random()<.5?-1:1,r=v*Math.random()*k,g=1,D=u*Math.random()*k;w.position.set(r,g,D),w.name="randomCube",w.castShadow=!0,w.receiveShadow=!0,n.add(w);const E=new ee(new J(1,1,1)),m=new $({mass:0});m.position.set(r,g,D),m.addShape(E),s.addBody(m),w.userData.physics=m,t.push(w)}}const{document:he,window:se}=Ce;function de(n){let s,t;return{c(){s=P("h1"),t=L("Dead."),this.h()},l(o){s=x(o,"H1",{class:!0});var e=q(s);t=C(e,"Dead."),e.forEach(b),this.h()},h(){ie(s,"class","text-red-800")},m(o,e){K(o,s,e),l(s,t)},d(o){o&&b(s)}}}function Ae(n){let s,t,o,e,i,w,k,v,u,r,g,D,E,m,f,y,F,Q,_,z,G,j,V,a=n[3]&&de();return{c(){s=I(),t=P("canvas"),o=I(),e=P("div"),i=P("h1"),w=L("Highscore: "),k=L(n[1]),v=I(),u=P("h1"),r=L("Score: "),g=L(n[0]),D=I(),E=P("p"),m=L("Use the 'wasd' keys to move around"),f=I(),y=P("p"),F=L("Press space to jump"),Q=I(),_=P("p"),z=L("Press 'r' to restart"),G=I(),a&&a.c(),this.h()},l(c){be('[data-svelte="svelte-1uqsw9u"]',he.head).forEach(b),s=B(c),t=x(c,"CANVAS",{}),q(t).forEach(b),o=B(c),e=x(c,"DIV",{class:!0});var p=q(e);i=x(p,"H1",{});var W=q(i);w=C(W,"Highscore: "),k=C(W,n[1]),W.forEach(b),v=B(p),u=x(p,"H1",{});var X=q(u);r=C(X,"Score: "),g=C(X,n[0]),X.forEach(b),D=B(p),E=x(p,"P",{});var Y=q(E);m=C(Y,"Use the 'wasd' keys to move around"),Y.forEach(b),f=B(p),y=x(p,"P",{});var Z=q(y);F=C(Z,"Press space to jump"),Z.forEach(b),Q=B(p),_=x(p,"P",{});var R=q(_);z=C(R,"Press 'r' to restart"),R.forEach(b),G=B(p),a&&a.l(p),p.forEach(b),this.h()},h(){he.title="The Floor is Lava!",ie(e,"class","absolute top-0")},m(c,S){K(c,s,S),K(c,t,S),n[10](t),K(c,o,S),K(c,e,S),l(e,i),l(i,w),l(i,k),l(e,v),l(e,u),l(u,r),l(u,g),l(e,D),l(e,E),l(E,m),l(e,f),l(e,y),l(y,F),l(e,Q),l(e,_),l(_,z),l(e,G),a&&a.m(e,null),j||(V=[te(se,"focus",n[8]),te(se,"resize",n[7]),te(se,"keypress",n[9])],j=!0)},p(c,[S]){S&2&&re(k,c[1]),S&1&&re(g,c[0]),c[3]?a||(a=de(),a.c(),a.m(e,null)):a&&(a.d(1),a=null)},i:ce,o:ce,d(c){c&&b(s),c&&b(t),n[10](null),c&&b(o),c&&b(e),a&&a.d(),j=!1,ke(V)}}}const H=100;function Fe(n,s,t){let o=0,e=0,i=!1,w=!1,k,v,u,r,g,D=[];const E=new ze(!0),m=new ge;m.gravity.set(0,-24,0),m.broadphase=new Ee;const f=new Se;f.background=new Me(11184810);const y=new De;y.position.set(H,H,H),y.castShadow=!0,y.shadow.mapSize=new _e(2048,2048),y.shadow.camera.left=-H,y.shadow.camera.right=H,y.shadow.camera.top=H,y.shadow.camera.bottom=-H,f.add(y);const F=new Pe(11184810,11184810,.7);f.add(F);const Q=new Le(100,100,1,1);Q.rotateX(-Math.PI/2);let _=new U({color:16711680});const z=new O(Q,_);z.name="floor",z.receiveShadow=!0,f.add(z);const G=new xe,j=new $({mass:0});j.addShape(G),j.quaternion.setFromAxisAngle(new J(1,0,0),-Math.PI/2),m.addBody(j);const V=new ne(2,2,2);_=new U({color:65280});const a=new O(V,_);a.castShadow=!0,a.receiveShadow=!0,a.name="player",f.add(a);const c=new ee(new J(1,1,1));r=new $({mass:10}),r.position.set(0,10,0),r.addShape(c),m.addBody(r);function S(){if(requestAnimationFrame(S),i){const h=E.getDelta();m.step(h),g.canMove?(a.position.x=r.position.x,a.position.y=r.position.y,a.position.z=r.position.z):a.position.y>-2&&(a.position.y-=.01),a.quaternion.x=r.quaternion.x,a.quaternion.y=r.quaternion.y,a.quaternion.z=r.quaternion.z,a.quaternion.w=r.quaternion.w,D.forEach(d=>{const M=d.userData.physics.position;d.position.x=M.x,d.position.y=M.y,d.position.z=M.z;const T=d.userData.physics.quaternion;d.quaternion.x=T.x,d.quaternion.y=T.y,d.quaternion.z=T.z,d.quaternion.w=T.w,d.material.color.r<.5&&(M.y<-2?f.remove(d):M.y-=.01)}),g.update(),v.render(f,u)}}function p(){t(2,i=!0),t(3,w=!1),g.canMove=!0,t(0,o=0),D.forEach(h=>{m.removeBody(h.userData.physics),f.remove(h)}),r.position.set(0,10,0),Qe(f,m,D),W()}function W(){_=new U({color:11184810});const h=new O(V,_);h.position.y+=1,h.castShadow=!0,h.receiveShadow=!0,h.name="randomCube",f.add(h);const d=new ee(new J(1,1,1)),M=new $({mass:0});M.position.set(0,1,0),M.addShape(d),m.addBody(M),h.userData.physics=M,D.push(h)}function X(){u.aspect=window.innerWidth/window.innerHeight,u.updateProjectionMatrix(),v.setSize(window.innerWidth,window.innerHeight)}function Y(h){const d=h.detail.object,M=d.material.color;d.name==="floor"?(t(3,w=!0),o>=e&&(localStorage.setItem("highscore",o),t(1,e=o))):d.name==="randomCube"&&M.r>.5&&(t(0,o+=1),d.material=new U({color:3355443}))}qe(()=>(localStorage.getItem("highscore")==null?localStorage.setItem("highscore",0):t(1,e=localStorage.getItem("highscore")),v=new je({canvas:k,logarithmicDepthBuffer:!0}),v.shadowMap.enabled=!0,v.setSize(window.innerWidth,window.innerHeight),u=new Ie(90,window.innerWidth/window.innerHeight,.01,1e3),u.position.set(10,10,10),f.add(u),g=new He(r,u,v.domElement),document.addEventListener("player",Y),p(),S(),()=>{document.removeEventListener("player",Y),u=null,v.forceContextLoss(),v.dispose(),cancelAnimationFrame(S)}));const Z=()=>{document.visibilityState==="hidden"?(t(2,i=!1),E.stop()):(E.start(),t(2,i=!0))},R=h=>{h.key=="r"&&p()};function le(h){Be[h?"unshift":"push"](()=>{k=h,t(4,k)})}return[o,e,i,w,k,E,p,X,Z,R,le]}class We extends fe{constructor(s){super();ve(this,s,Fe,Ae,ye,{})}}export{We as default};
